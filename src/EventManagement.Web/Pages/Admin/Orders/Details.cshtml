@page "{id:int}"
@inject IOrderService orderService
@{
    var id = Convert.ToInt32(RouteData.Values["id"]);
    var order = await orderService.GetByIdAsync(id);
}
<div class="container">
	<div class="row">
        <div class="col">
            <h2>
                Order #@order.OrderId 
                <small><order-status value="@order.Status" /></small>
            </h2>

            <h4>Participant</h4>
            <dl class="row">
                <dt class="col-6 col-md-3 col-lg-2 text-right">Participant Name</dt>
                <dd class="col-6 col-md-9 col-lg-10">@(order.User?.Name ?? "NIL")</dd>
                <dt class="col-6 col-md-3 col-lg-2 text-right">Participant Email</dt>
                <dd class="col-6 col-md-9 col-lg-10">@(order.User?.Email ?? "NIL")</dd>
                <dt class="col-6 col-md-3 col-lg-2 text-right">Participant Phone</dt>
                <dd class="col-6 col-md-9 col-lg-10">@(order.User?.PhoneNumber ?? "NIL")</dd>
            </dl>

            <h4>Customer</h4>
            <dl class="row">
                <dt class="col-6 col-md-3 col-lg-2 text-right">Customer Name</dt>
                <dd class="col-6 col-md-9 col-lg-10">@order.CustomerName</dd>
                <dt class="col-6 col-md-3 col-lg-2 text-right">Customer Email</dt>
                <dd class="col-6 col-md-9 col-lg-10">@order.CustomerEmail</dd>
                <dt class="col-6 col-md-3 col-lg-2 text-right">Customer Invoice Reference</dt>
                <dd class="col-6 col-md-9 col-lg-10">@order.CustomerInvoiceReference</dd>
            </dl>
            
            <h4>
                Order Lines 
                @if(order.CanEdit)
                {
                    <button class="btn btn-default">Add Line</button>
                }
            </h4>
            <table class="table">
                <thead>
                    <tr>
                        <th>Line#</th>
                        <th>Product ID</th>
                        <th>Product Name</th>
                        <th>Variant ID</th>
                        <th>Variant Name</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        @if(order.CanEdit)
                        {
                            <th></th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach(var line in order.OrderLines)
                    {
                        <tr>
                            <td>@line.OrderLineId</td>
                            <td>@line.ProductId</td>
                            <td>@line.ProductName</td>
                            <td>@(line.ProductVariantId?.ToString() ?? "NA")</td>
                            <td>@(line.ProductVariantName ?? "NA")</td>
                            <td>@line.Quantity</td>
                            <td>@line.Price</td>
                            @if(order.CanEdit)
                            {
                                <td>
                                    <a tabindex="0" class="btn btn-sm btn-danger" role="button"       
                                        data-toggle="popover" 
                                        data-trigger="focus" 
                                        title="Delete line?" 
                                        data-content="<button class='btn btn-sm btn-danger'>Yes</button><button class='btn btn-sm btn-success'>No</button>">
                                        <i class="material-icons md-light md-18">delete</i>
                                    </a>
                                </td>
                            }
                        </tr>
                    }
                </tbody>
            </table>

            <h4>Order Information</h4>
            <dl class="row">
                <dt class="col-6 col-md-3 col-lg-2 text-right">Order ID</dt>
                <dd class="col-6 col-md-9 col-lg-10">@order.OrderId</dd>
                <dt class="col-6 col-md-3 col-lg-2 text-right">User ID</dt>
                <dd class="col-6 col-md-9 col-lg-10"><code>@(order.UserId ?? "Unavailable")</code></dd>
                <dt class="col-6 col-md-3 col-lg-2 text-right">Registration ID</dt>
                <dd class="col-6 col-md-9 col-lg-10">@order.RegistrationId</dd>
                <dt class="col-6 col-md-3 col-lg-2 text-right">Order Status</dt>
                <dd class="col-6 col-md-9 col-lg-10"><order-status value="@order.Status" /></dd>
                <dt class="col-6 col-md-3 col-lg-2 text-right">Order Time</dt>
                <dd class="col-6 col-md-9 col-lg-10">@order.OrderTime</dd>
            </dl>

            <strong>Comments</strong><br />
            <pre>@order.Comments</pre>

            <strong>Log</strong><br />
            <pre>@order.Log</pre>
        </div>
    </div>
</div>



@section scripts { 
    <script>
        $(function () {
            $('[data-toggle="popover"]').popover({
                html: true
            })
        })
    </script>
}